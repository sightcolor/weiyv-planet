
一个场景，人在图书馆看书
大脑正在思考的神经元------>寄存器 我们直接控制
中短期记忆---------------->cpu的L1缓存(数据缓存和指令缓存)
长期记忆------------------>cpu的L2/L3缓存
桌子上的的书--------------> 内存
架子上的书----------------> 外存

从架子上拿书放在桌子上然后看书开始调用神经元开始思考 ----------> 从外存拿到内容放到内存中然后cpu加载到寄存器开始运算

cpu缓存(SRAM): 静态随机存储器----断电数据立刻消失。
内存(DRAM): 动态随机存储器-----数据会被存储在电容里面，但是电容会不断漏电，所以定时刷新才能保证数据不丢失。
外存：
- 固态硬盘(SSD)：结构与内存相似，但是断电后数据还在。
- 机械硬盘(HDD): 物理读写访问数据。

cpu缓存一致性：
当数据写的时候如何同步更新到内存呢
1. 写直回：如果缓存有，先写缓存再写内存，没有的话直接写内存。
2. 写回：直接写缓存并且标记为脏，当缓存块被移除如果为脏则再写入内存。

如果采用写回 会出现多核心缓存数据不一致问题，所以要保证下面两个机制（
1. 写传播：当一个核心的cache更新时，必须其他核心的cache也要修改
2. 事务串行化：要保证数据变化是相同的。实现方式如下：
    - 总线嗅探： 通过总线进行广播
    - MESI协议：
     - Modified，已修改 cache的数据被修改但是还没有写到内存
     - Exclusive，独占 数据是一致的 只有一个核心用于该cache 当有其他核心使用的时候会变为共享
     - Shared，共享 数据是一致的
     - Invalidated，已失效 一个核心想要修改时 通知其他核心他们cache的已经是无效的了
cache伪共享：
两个核心都对同一个cacheline交替操作 会导致频繁访问内存


中断
中断是指的系统响应硬件设备请求的一种机制，操作系统收到硬件设备的请求会调用内核的中断处理程序来响应
中断是异步的一种处理机制可以提升系统的并发能力
所以中断处理程序必须断且快 因为处理中断的时候其他应用程序是被停止的 同时也是无法继续处理中断信息的
所以引入中断的两个过程
- 硬中断：快速处理中断  --会打断cpu正在执行的任务 硬件中断
- 软中断：处理硬中断没处理完的事情 延迟执行  --以内核线程的形式继续完成任务 每个cpu核心都对应一个内核线程  内核中断
